(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[40],{1878:(e,s,l)=>{"use strict";l.r(s),l.d(s,{default:()=>H});var t=l(5155),a=l(2115),i=l(6766),r=l(6874),n=l.n(r),d=l(2355),c=l(5623),o=l(1788),m=l(9946);let x=(0,m.A)("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);var u=l(5339),h=l(4186),p=l(9074),j=l(8564),f=l(1978),g=l(3619),v=l(9303);function N(e){var s,l,a,r,m,N;let{order:y}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)(f.$,{variant:"ghost",size:"sm",className:"gap-1",asChild:!0,children:(0,t.jsxs)(n(),{href:"/orders",children:[(0,t.jsx)(d.A,{className:"h-4 w-4"}),"Back to Orders"]})}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"/"}),(0,t.jsxs)("span",{children:["Order #",y.id]})]}),(0,t.jsxs)(v.rI,{children:[(0,t.jsx)(v.ty,{asChild:!0,children:(0,t.jsx)(f.$,{variant:"ghost",size:"icon",children:(0,t.jsx)(c.A,{className:"h-4 w-4"})})}),(0,t.jsxs)(v.SQ,{align:"end",children:[(0,t.jsxs)(v._2,{className:"gap-2",children:[(0,t.jsx)(o.A,{className:"h-4 w-4"}),"Download Invoice"]}),(0,t.jsxs)(v._2,{className:"gap-2",children:[(0,t.jsx)(x,{className:"h-4 w-4"}),"Report Issue"]}),(0,t.jsxs)(v._2,{className:"gap-2",children:[(0,t.jsx)(u.A,{className:"h-4 w-4"}),"Request Cancellation"]})]})]})]}),(0,t.jsx)("div",{className:"flex flex-col md:flex-row gap-6 items-start",children:(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:y.title}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[(0,t.jsx)(g.E,{className:{Pending:"bg-yellow-500","In Progress":"bg-blue-500",Completed:"bg-green-500",Cancelled:"bg-red-500",Delivered:"bg-purple-500"}[y.status]||"bg-blue-500",children:y.status}),(0,t.jsxs)("div",{className:"flex items-center gap-1 text-sm",children:[(0,t.jsx)(h.A,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsxs)("span",{children:["Due: ",y.deliveryDate]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 text-sm",children:[(0,t.jsx)(p.A,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsxs)("span",{children:["Ordered: ",y.orderDate]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,t.jsx)("div",{className:"h-10 w-10 rounded-full overflow-hidden",children:(0,t.jsx)(i.default,{src:(null===(s=y.seller)||void 0===s?void 0:s.avatar)||"/placeholder.svg",alt:(null===(l=y.seller)||void 0===l?void 0:l.name)||"Seller",width:40,height:40,className:"object-cover"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h3",{className:"font-semibold",children:(null===(a=y.seller)||void 0===a?void 0:a.name)||"Seller"}),(0,t.jsx)(g.E,{variant:"outline",className:"text-xs",children:(null===(r=y.seller)||void 0===r?void 0:r.level)||"Seller"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 text-amber-500",children:[(0,t.jsx)(j.A,{className:"h-3 w-3 fill-current"}),(0,t.jsx)("span",{className:"text-xs font-medium",children:(null===(m=y.seller)||void 0===m?void 0:m.rating)||"N/A"}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",(null===(N=y.seller)||void 0===N?void 0:N.reviews)||0," reviews)"]})]})]})]})]})})]})}var y=l(9615),w=l(9295),b=l(3800),C=l(5178),A=l(8552),D=l(1497),k=l(1154),S=l(6671),R=l(1107);function F(e){let{order:s}=e,[l,i]=(0,a.useState)(!1),[r,n]=(0,a.useState)(""),[d,c]=(0,a.useState)(!1),o=async()=>{if(!r.trim()){(0,S.oR)({title:"Error",description:"Please provide a reason for cancellation.",variant:"destructive"});return}try{c(!0),await (0,R.Ns)(s.id,{reason:r}),(0,S.oR)({title:"Cancellation requested",description:"Your cancellation request has been submitted and is pending review."}),i(!1),n("")}catch(e){console.error("Failed to request cancellation:",e),(0,S.oR)({title:"Failed to request cancellation",description:"Please try again later.",variant:"destructive"})}finally{c(!1)}};return(0,t.jsxs)(b.Zp,{className:"w-full md:w-[300px]",children:[(0,t.jsx)(b.aR,{className:"pb-2",children:(0,t.jsx)(b.ZB,{className:"text-lg",children:"Order Summary"})}),(0,t.jsxs)(b.Wu,{className:"pb-2",children:[console.log(s),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Order ID:"}),(0,t.jsxs)("span",{className:"font-medium",children:["#",s._id]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Price:"}),(0,t.jsxs)("span",{className:"font-medium",children:["\xa3",s.price]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Order Date:"}),(0,t.jsxs)("span",{className:"font-medium",children:["  ",new Date(s.createdAt).toISOString().split("T")[0]]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Delivery Date:"}),(0,t.jsxs)("span",{className:"font-medium",children:["  ",new Date(s.dueDate).toISOString().split("T")[0]]})]}),(0,t.jsx)(w.w,{className:"my-2"}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Progress:"}),(0,t.jsxs)("span",{className:"font-medium",children:[s.progress||0,"%"]})]}),(0,t.jsx)(y.k,{value:s.progress||0,className:"h-2"})]})]}),(0,t.jsxs)(b.wL,{className:"flex flex-col gap-2 pt-2",children:[(0,t.jsxs)(f.$,{className:"w-full gap-2",children:[(0,t.jsx)(D.A,{className:"h-4 w-4"}),"Contact Seller"]}),(0,t.jsxs)(C.lG,{open:l,onOpenChange:i,children:[(0,t.jsx)(C.zM,{asChild:!0,children:(0,t.jsxs)(f.$,{variant:"outline",className:"w-full gap-2",children:[(0,t.jsx)(x,{className:"h-4 w-4"}),"Report Issue"]})}),(0,t.jsxs)(C.Cf,{children:[(0,t.jsxs)(C.c7,{children:[(0,t.jsx)(C.L3,{children:"Report an Issue"}),(0,t.jsx)(C.rr,{children:"Describe the issue you're experiencing with this order."})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{htmlFor:"issue-type",className:"text-sm font-medium",children:"Issue Type"}),(0,t.jsxs)("select",{id:"issue-type",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[(0,t.jsx)("option",{value:"quality",children:"Quality Issues"}),(0,t.jsx)("option",{value:"communication",children:"Communication Problems"}),(0,t.jsx)("option",{value:"delivery",children:"Late Delivery"}),(0,t.jsx)("option",{value:"requirements",children:"Requirements Not Met"}),(0,t.jsx)("option",{value:"other",children:"Other"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{htmlFor:"issue-description",className:"text-sm font-medium",children:"Description"}),(0,t.jsx)(A.T,{id:"issue-description",placeholder:"Please provide details about the issue...",className:"min-h-[100px]",value:r,onChange:e=>n(e.target.value)})]})]}),(0,t.jsxs)(C.Es,{children:[(0,t.jsx)(f.$,{variant:"outline",onClick:()=>i(!1),disabled:d,children:"Cancel"}),(0,t.jsx)(f.$,{type:"submit",onClick:o,disabled:d,children:d?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(k.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Submitting..."]}):"Submit Report"})]})]})]})]})]})}var P=l(6198);function z(e,s,l){switch(e){case"pdf":return(0,t.jsx)(s,{className:"h-5 w-5 text-red-500"});case"image":return(0,t.jsx)(l,{src:"/placeholder.svg?height=20&width=20",alt:"Image",width:20,height:20,className:"h-5 w-5 rounded"});default:return(0,t.jsx)(s,{className:"h-5 w-5"})}}var _=l(7434),I=l(492),M=l(2486),$=l(350);function O(e){let{messages:s=[],seller:l,orderId:r}=e,[n,d]=(0,a.useState)(s),[c,m]=(0,a.useState)(""),[x,u]=(0,a.useState)(""),[h,p]=(0,a.useState)(!1),j=(0,a.useRef)(null),g=async()=>{if(c.trim()||x)try{p(!0);let e={id:(await (0,R.tj)(r,{text:c,attachment:x}))._id||Date.now().toString(),sender:"buyer",text:c,createdAt:new Date().toISOString(),attachment:x?{name:x.name,url:URL.createObjectURL(x)}:null};d([...n,e]),m(""),u(null),(0,S.oR)({title:"Message sent",description:"Your message has been sent successfully."})}catch(e){console.error("Failed to send message:",e),(0,S.oR)({title:"Failed to send message",description:"Please try again later.",variant:"destructive"})}finally{p(!1)}},v=e=>{if(!e)return"";if("string"==typeof e&&e.includes("•"))return e;let s=new Date(e);return s.toLocaleDateString()+" • "+s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};return(0,t.jsxs)(b.Zp,{children:[(0,t.jsxs)(b.aR,{children:[(0,t.jsx)(b.ZB,{children:"Conversation"}),(0,t.jsx)(b.BT,{children:"Communication history between you and the seller"})]}),(0,t.jsx)(b.Wu,{children:(0,t.jsx)("div",{className:"space-y-6 max-h-[600px] overflow-y-auto p-1",children:0===n.length?(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No messages yet. Start the conversation!"}):n.map(e=>(0,t.jsx)("div",{className:"flex ".concat("buyer"===e.sender?"justify-end":"justify-start"),children:(0,t.jsxs)("div",{className:"max-w-[80%] md:max-w-[70%] rounded-lg p-4 ".concat("buyer"===e.sender?"bg-primary text-primary-foreground":"bg-muted"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:["seller"===e.sender&&(0,t.jsx)("div",{className:"h-8 w-8 rounded-full overflow-hidden",children:(0,t.jsx)(i.default,{src:(null==l?void 0:l.avatar)||"/placeholder.svg",alt:(null==l?void 0:l.name)||"Seller",width:32,height:32,className:"object-cover"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"buyer"===e.sender?"You":(null==l?void 0:l.name)||"Seller"}),(0,t.jsx)("p",{className:"text-xs ".concat("buyer"===e.sender?"text-primary-foreground/70":"text-muted-foreground"),children:v(e.createdAt||e.time)})]})]}),(0,t.jsx)("p",{className:"text-sm",children:e.text}),e.attachment&&(0,t.jsxs)("div",{className:"mt-2 p-2 bg-background rounded flex items-center gap-2",children:[(0,t.jsx)(_.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-sm",children:"string"==typeof e.attachment?"Attachment":e.attachment.name||"Attachment"}),(0,t.jsx)(f.$,{variant:"ghost",size:"sm",className:"ml-auto h-7 w-7 p-0",onClick:()=>window.open("string"==typeof e.attachment?e.attachment:e.attachment.url,"_blank"),children:(0,t.jsx)(o.A,{className:"h-4 w-4"})})]})]})},e._id))})}),(0,t.jsx)(b.wL,{children:(0,t.jsxs)("div",{className:"flex w-full items-center gap-2",children:[(0,t.jsx)("input",{type:"file",ref:j,onChange:e=>{var s;(null===(s=e.target.files)||void 0===s?void 0:s[0])&&u(e.target.files[0])},className:"hidden"}),(0,t.jsx)(f.$,{variant:"outline",size:"icon",className:"shrink-0",onClick:()=>{j.current&&j.current.click()},children:(0,t.jsx)(I.A,{className:"h-4 w-4"})}),x&&(0,t.jsxs)("div",{className:"px-2 py-1 bg-muted rounded text-xs flex items-center gap-1",children:[x.name,(0,t.jsx)(f.$,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 ml-1",onClick:()=>u(null),children:"✕"})]}),(0,t.jsx)($.p,{placeholder:"Type your message...",className:"flex-1",value:c,onChange:e=>m(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),g())}}),(0,t.jsx)(f.$,{size:"sm",className:"shrink-0 gap-1",onClick:g,disabled:h||!c.trim()&&!x,children:h?(0,t.jsx)(k.A,{className:"h-4 w-4 animate-spin"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(M.A,{className:"h-4 w-4"}),"Send"]})})]})})]})}var q=l(9869),B=l(4416),E=l(3859),T=l(4475);function L(e){let{files:s=[],orderId:l}=e,[r,n]=(0,a.useState)(s),[d,c]=(0,a.useState)(!1),[m,x]=(0,a.useState)(null),[u,h]=(0,a.useState)(""),[p,j]=(0,a.useState)(!1),[g,v]=(0,a.useState)(!1),N=(0,a.useRef)(null),y=["application/pdf","image/jpeg","image/jpg","image/png","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],w=e=>e?"string"==typeof e&&e.includes(" ")?e:new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",D=e=>{if(!e)return"";if("string"!=typeof e||isNaN(e)||(e=parseInt(e)),"string"==typeof e&&e.includes(" "))return e;if(isNaN(e))return"Unknown size";if(0===e)return"0 Byte";let s=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,s)*100)/100+" "+["Bytes","KB","MB","GB","TB"][s]},F=e=>e?e.size>0xa00000?"File size exceeds 10MB limit":y.includes(e.type)?null:"File type not supported. Please use PDF, JPG, PNG, DOC, or DOCX files.":"No file selected",P=()=>{N.current&&N.current.click()},I=async()=>{if(!m)return;let e=F(m);if(e){S.oR.error("Invalid file",{description:e});return}try{j(!0);let e=await (0,R._X)(m);if(!e.success)throw Error(e.message||"File upload failed");let s={name:e.file.filename,originalName:e.file.originalName,url:e.file.url,size:e.file.size,type:e.file.mimetype,description:u.trim()},t={id:(await (0,R.QM)(l,s))._id||Date.now().toString(),name:e.file.originalName||m.name,type:e.file.mimetype||m.type,size:e.file.size||m.size,createdAt:new Date().toISOString(),url:e.file.url,description:u.trim()};n(e=>[...e,t]),c(!1),M(),S.oR.success("File uploaded",{description:"Your file has been uploaded successfully."})}catch(e){console.error("Failed to upload file:",e),S.oR.error("Failed to upload file",{description:e.message||"Please try again later."})}finally{j(!1)}},M=()=>{x(null),h(""),N.current&&(N.current.value="")},$=()=>{p||(c(!1),M())};return(0,t.jsxs)(b.Zp,{children:[(0,t.jsxs)(b.aR,{className:"flex flex-row items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(b.ZB,{children:"Project Files"}),(0,t.jsx)(b.BT,{children:"All files shared between you and the seller"})]}),(0,t.jsxs)(C.lG,{open:d,onOpenChange:$,children:[(0,t.jsx)(C.zM,{asChild:!0,children:(0,t.jsxs)(f.$,{size:"sm",className:"gap-1",children:[(0,t.jsx)(q.A,{className:"h-4 w-4"}),"Upload File"]})}),(0,t.jsxs)(C.Cf,{className:"sm:max-w-md",children:[(0,t.jsxs)(C.c7,{children:[(0,t.jsx)(C.L3,{children:"Upload File"}),(0,t.jsx)(C.rr,{children:"Upload a file to share with the seller"})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsx)("input",{ref:N,type:"file",onChange:e=>{var s;let l=null===(s=e.target.files)||void 0===s?void 0:s[0];if(l){let e=F(l);if(e){S.oR.error("Invalid file",{description:e});return}x(l)}},accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",className:"hidden"}),(0,t.jsx)("div",{className:"border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors ".concat(g?"border-primary bg-primary/5":"border-border hover:bg-muted/50"),onClick:P,onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),v(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),v(!1)},onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{e.preventDefault(),e.stopPropagation(),v(!1);let s=e.dataTransfer.files;if(null==s?void 0:s[0]){let e=s[0],l=F(e);if(l){S.oR.error("Invalid file",{description:l});return}x(e)}},children:m?(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(_.A,{className:"h-8 w-8 mx-auto text-primary"}),(0,t.jsx)("p",{className:"text-sm font-medium",children:m.name}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:D(m.size)}),(0,t.jsxs)(f.$,{variant:"ghost",size:"sm",className:"mt-2",onClick:e=>{e.stopPropagation(),x(null)},children:[(0,t.jsx)(B.A,{className:"h-4 w-4 mr-1"}),"Remove file"]})]}):(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(q.A,{className:"h-8 w-8 mx-auto text-muted-foreground"}),(0,t.jsx)("p",{className:"text-sm font-medium",children:g?"Drop your file here":"Drag and drop your file here"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"or"}),(0,t.jsx)(f.$,{size:"sm",onClick:e=>{e.stopPropagation(),P()},children:"Browse Files"}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Max file size: 10MB",(0,t.jsx)("br",{}),"Supported formats: PDF, JPG, PNG, DOC, DOCX"]})]})}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{htmlFor:"file-description",className:"text-sm font-medium",children:"Description (optional)"}),(0,t.jsx)(A.T,{id:"file-description",placeholder:"Add a description for this file...",className:"min-h-[80px] resize-none",value:u,onChange:e=>h(e.target.value),disabled:p,maxLength:500}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground text-right",children:[u.length,"/500"]})]})]}),(0,t.jsxs)(C.Es,{children:[(0,t.jsx)(f.$,{variant:"outline",onClick:$,disabled:p,children:"Cancel"}),(0,t.jsx)(f.$,{type:"submit",onClick:I,disabled:!m||p,children:p?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(k.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Uploading..."]}):"Upload"})]})]})]})]}),(0,t.jsx)(b.Wu,{children:(0,t.jsx)("div",{className:"space-y-4",children:0===r.length?(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(_.A,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,t.jsx)("p",{className:"text-sm",children:"No files have been shared yet."}),(0,t.jsx)("p",{className:"text-xs",children:"Upload a file to get started."})]}):r.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/25 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[z(e.type||e.fileType,_.A,i.default),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("p",{className:"font-medium truncate",children:e.name}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,t.jsx)("span",{children:D(e.size)}),(0,t.jsx)("span",{children:"•"}),(0,t.jsx)("span",{children:w(e.createdAt||e.date)})]}),e.description&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:e.description})]})]}),(0,t.jsx)("div",{className:"flex items-center gap-2 ml-2",children:(0,t.jsx)(E.Bc,{children:(0,t.jsxs)(E.m_,{children:[(0,t.jsx)(E.k$,{asChild:!0,children:(0,t.jsx)(f.$,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{e.url?window.open(T.H+e.url,"_blank","noopener,noreferrer"):S.oR.error("File not available",{description:"The file URL is not accessible."})},children:(0,t.jsx)(o.A,{className:"h-4 w-4"})})}),(0,t.jsx)(E.ZI,{children:(0,t.jsx)("p",{children:"Download"})})]})})})]},e.id))})})]})}var U=l(646);let Z=(0,m.A)("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]);function W(e){let{milestones:s=[],orderId:l}=e,[i,r]=(0,a.useState)(s),[n,d]=(0,a.useState)(!1),[c,o]=(0,a.useState)(""),[m,x]=(0,a.useState)(null),[u,h]=(0,a.useState)(!1),p=e=>e?"string"==typeof e&&e.includes(" ")?e:new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",j=async()=>{if(m)try{d(!0);let e=m.id||m._id;await (0,R.ui)(l,e,{feedback:c,status:"completed"});let s=i.map(s=>(s.id||s._id)===e?{...s,status:"completed",feedback:c,approvedAt:new Date().toISOString()}:s);r(s),h(!1),(0,S.oR)({title:"Milestone approved",description:"The milestone has been successfully approved."}),o(""),x(null)}catch(e){console.error("Failed to approve milestone:",e),(0,S.oR)({title:"Failed to approve milestone",description:"Please try again later.",variant:"destructive"})}finally{d(!1)}},v=e=>{x(e),h(!0)},N=async e=>{try{d(!0);let s=e.id||e._id;await (0,R.xU)(l,s,{status:"in-progress",revisionRequested:!0,revisionNote:"Revision requested by buyer"});let t=i.map(e=>(e.id||e._id)===s?{...e,status:"in-progress",revisionRequested:!0,revisionNote:"Revision requested by buyer"}:e);r(t),(0,S.oR)({title:"Revision requested",description:"The seller has been notified about the revision request."})}catch(e){console.error("Failed to request revision:",e),(0,S.oR)({title:"Failed to request revision",description:"Please try again later.",variant:"destructive"})}finally{d(!1)}},y=e=>({pending:"Pending","in-progress":"In Progress",completed:"Completed"})[e]||e;return(0,t.jsxs)(b.Zp,{children:[(0,t.jsxs)(b.aR,{children:[(0,t.jsx)(b.ZB,{children:"Project Milestones"}),(0,t.jsx)(b.BT,{children:"Track the progress of your project through these milestones"})]}),(0,t.jsx)(b.Wu,{children:(0,t.jsx)("div",{className:"space-y-6",children:0===i.length?(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No milestones defined for this project."}):i.map((e,s)=>(0,t.jsxs)("div",{className:"relative",children:[s<i.length-1&&(0,t.jsx)("div",{className:"absolute top-6 left-3 bottom-0 w-0.5 bg-border"}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)("div",{className:"h-6 w-6 rounded-full flex items-center justify-center shrink-0 ".concat("completed"===e.status?"bg-green-500 text-white":"in-progress"===e.status?"bg-blue-500 text-white":"bg-muted"),children:"completed"===e.status?(0,t.jsx)(U.A,{className:"h-4 w-4"}):(0,t.jsx)("span",{className:"h-2 w-2 rounded-full bg-current"})}),(0,t.jsxs)("div",{className:"flex-1 pb-6",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[(0,t.jsx)("h3",{className:"font-semibold",children:e.title}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(g.E,{variant:"completed"===e.status?"default":"in-progress"===e.status?"secondary":"outline",children:y(e.status)}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:p(e.date||e.dueDate)})]})]}),e.description&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description}),e.revisionRequested&&"in-progress"===e.status&&(0,t.jsx)("div",{className:"mt-2 p-2 bg-orange-50 border border-orange-200 rounded-md",children:(0,t.jsx)("p",{className:"text-sm text-orange-800",children:"⏱️ Revision requested - Seller is working on updates"})}),"completed"===e.status&&!e.approvedAt&&(0,t.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[e.deliverable&&(0,t.jsxs)(f.$,{variant:"outline",size:"sm",className:"gap-1",onClick:()=>window.open(T.H+e.deliverable.url,"_blank"),children:[(0,t.jsx)(_.A,{className:"h-4 w-4"}),"View Deliverable"]}),(0,t.jsxs)(C.lG,{open:u&&((null==m?void 0:m.id)||(null==m?void 0:m._id))===(e.id||e._id),onOpenChange:e=>{h(e),e||x(null)},children:[(0,t.jsx)(C.zM,{asChild:!0,children:(0,t.jsxs)(f.$,{size:"sm",className:"gap-1",onClick:()=>v(e),children:[(0,t.jsx)(Z,{className:"h-4 w-4"}),"Approve Milestone"]})}),(0,t.jsxs)(C.Cf,{children:[(0,t.jsxs)(C.c7,{children:[(0,t.jsx)(C.L3,{children:"Approve Milestone"}),(0,t.jsx)(C.rr,{children:"Are you satisfied with the deliverable for this milestone?"})]}),(0,t.jsxs)("div",{className:"py-4",children:[(0,t.jsx)("p",{className:"font-medium",children:null==m?void 0:m.title}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Approving this milestone will mark it as completed and allow the seller to proceed to the next phase."}),(0,t.jsx)(A.T,{className:"mt-4",placeholder:"Add feedback or comments (optional)...",value:c,onChange:e=>o(e.target.value)})]}),(0,t.jsxs)(C.Es,{children:[(0,t.jsx)(f.$,{variant:"outline",onClick:()=>{h(!1),x(null),o("")},disabled:n,children:"Cancel"}),(0,t.jsx)(f.$,{onClick:j,disabled:n,children:n?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(k.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):"Approve"})]})]})]}),(0,t.jsxs)(f.$,{variant:"outline",size:"sm",className:"gap-1",onClick:()=>N(e),disabled:n,children:[(0,t.jsx)(D.A,{className:"h-4 w-4"}),"Request Revisions"]})]}),"completed"===e.status&&e.approvedAt&&(0,t.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[e.deliverable&&(0,t.jsxs)(f.$,{variant:"outline",size:"sm",className:"gap-1",onClick:()=>window.open(T.H+e.deliverable.url,"_blank"),children:[(0,t.jsx)(_.A,{className:"h-4 w-4"}),"View Deliverable"]}),(0,t.jsx)("div",{className:"text-sm text-green-600 font-medium",children:"✓ Approved"})]}),"in-progress"===e.status&&!e.revisionRequested&&(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"\uD83D\uDD04 Seller is working on this milestone"})}),"pending"===e.status&&(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"⏳ Waiting for seller to start"})})]})]})]},e.id||e._id||s))})})]})}function G(e){let{order:s}=e;return(0,t.jsxs)(P.tU,{defaultValue:"overview",className:"w-full",children:[(0,t.jsxs)(P.j7,{className:"grid w-full grid-cols-4",children:[(0,t.jsx)(P.Xi,{value:"overview",children:"Overview"}),(0,t.jsx)(P.Xi,{value:"messages",children:"Messages"}),(0,t.jsx)(P.Xi,{value:"files",children:"Files"}),(0,t.jsx)(P.Xi,{value:"milestones",children:"Milestones"})]}),(0,t.jsx)(P.av,{value:"overview",className:"pt-6",children:(0,t.jsx)(X,{order:s})}),(0,t.jsx)(P.av,{value:"messages",className:"pt-6",children:(0,t.jsx)(O,{messages:s.messages,seller:s.seller,orderId:s._id})}),(0,t.jsx)(P.av,{value:"files",className:"pt-6",children:(0,t.jsx)(L,{files:s.files,orderId:s._id})}),(0,t.jsx)(P.av,{value:"milestones",className:"pt-6",children:(0,t.jsx)(W,{milestones:s.milestones,orderId:s._id})})]})}function X(e){let{order:s}=e,l=e=>e?"string"==typeof e&&e.includes(" ")?e:new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",a=e=>(function(e){switch(e){case"completed":return"bg-green-500";case"in-progress":return"bg-blue-500";default:return"bg-gray-300"}})(e);return(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,t.jsxs)(b.Zp,{children:[(0,t.jsx)(b.aR,{children:(0,t.jsx)(b.ZB,{children:"Project Description"})}),(0,t.jsx)(b.Wu,{children:(0,t.jsx)("p",{className:"text-muted-foreground",children:s.description})})]}),(0,t.jsxs)(b.Zp,{children:[(0,t.jsx)(b.aR,{className:"pb-2",children:(0,t.jsx)(b.ZB,{children:"Recent Updates"})}),(0,t.jsx)(b.Wu,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[s.milestones&&s.milestones.filter(e=>"pending"!==e.status).slice(0,3).map(e=>(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"mt-1 h-3 w-3 rounded-full ".concat(a(e.status))}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:e.title}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["completed"===e.status?"Completed on ":"In progress since ",l(e.date||e.updatedAt)]})]})]},e.id)),(!s.milestones||0===s.milestones.filter(e=>"pending"!==e.status).length)&&(0,t.jsx)("div",{className:"text-center py-4 text-muted-foreground",children:"No recent updates available"})]})})]})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(b.Zp,{children:[(0,t.jsx)(b.aR,{className:"pb-2",children:(0,t.jsx)(b.ZB,{children:"Upcoming Milestones"})}),(0,t.jsx)(b.Wu,{children:(0,t.jsxs)("div",{className:"space-y-3",children:[s.milestones&&s.milestones.filter(e=>"completed"!==e.status).slice(0,3).map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:["in-progress"===e.status?(0,t.jsx)(h.A,{className:"h-4 w-4 text-blue-500"}):(0,t.jsx)(h.A,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("span",{className:"in-progress"===e.status?"font-medium":"text-muted-foreground",children:e.title})]}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:l(e.date||e.dueDate)})]},e.id)),(!s.milestones||0===s.milestones.filter(e=>"completed"!==e.status).length)&&(0,t.jsx)("div",{className:"text-center py-4 text-muted-foreground",children:"No upcoming milestones"})]})})]}),(0,t.jsxs)(b.Zp,{children:[(0,t.jsx)(b.aR,{className:"pb-2",children:(0,t.jsx)(b.ZB,{children:"Recent Files"})}),(0,t.jsx)(b.Wu,{children:(0,t.jsxs)("div",{className:"space-y-3",children:[s.files&&s.files.slice(0,3).map(e=>{let s=z(e.type||e.fileType,e=>(0,t.jsx)("span",{...e}),i.default);return(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[s,(0,t.jsx)("span",{className:"font-medium",children:e.name})]}),(0,t.jsx)(f.$,{variant:"ghost",size:"icon",onClick:()=>window.open(e.url,"_blank"),children:(0,t.jsx)(o.A,{className:"h-4 w-4"})})]},e.id)}),(!s.files||0===s.files.length)&&(0,t.jsx)("div",{className:"text-center py-4 text-muted-foreground",children:"No files uploaded yet"})]})}),s.files&&s.files.length>0&&(0,t.jsx)(b.wL,{children:(0,t.jsx)(f.$,{variant:"outline",size:"sm",className:"w-full",asChild:!0,children:(0,t.jsx)(n(),{href:"#files",children:"View All Files"})})})]})]})]})}var V=l(2139);function H(e){let{params:s}=e,l=a.use(s),i=(null==l?void 0:l.id)||"507f1f77bcf86cd799439011",[r,n]=(0,a.useState)(null),[d,c]=(0,a.useState)(!0),[o,m]=(0,a.useState)(null);return((0,a.useEffect)(()=>{(async function(){try{c(!0);let e=await (0,R.p)(i);console.log(e),n(e),c(!1)}catch(e){console.error("Failed to fetch order:",e),m("Failed to load order details. Please try again."),c(!1)}})()},[i]),d)?(0,t.jsx)("div",{className:"container px-4 py-8 md:px-6",children:(0,t.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,t.jsx)(V.E,{className:"h-12 w-full max-w-md"}),(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-6 items-start",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(V.E,{className:"h-8 w-3/4 mb-4"}),(0,t.jsx)(V.E,{className:"h-6 w-1/2 mb-3"}),(0,t.jsx)(V.E,{className:"h-24 w-full"})]}),(0,t.jsx)(V.E,{className:"w-full md:w-[300px] h-[250px]"})]}),(0,t.jsx)(V.E,{className:"h-[400px] w-full"})]})}):o?(0,t.jsx)("div",{className:"container px-4 py-8 md:px-6",children:(0,t.jsxs)("div",{className:"bg-red-50 border border-red-200 p-4 rounded-md text-red-700",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"Error"}),(0,t.jsx)("p",{children:o}),(0,t.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-red-100 hover:bg-red-200 rounded-md transition-colors",children:"Retry"})]})}):r?(0,t.jsx)("div",{className:"container px-4 py-8 md:px-6",children:(0,t.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,t.jsx)(N,{order:r}),(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-6 items-start",children:[(0,t.jsx)("div",{className:"flex-1"}),(0,t.jsx)("div",{className:"w-full md:w-auto flex flex-col gap-2",children:(0,t.jsx)(F,{order:r})})]}),(0,t.jsx)(G,{order:r})]})}):null}},5339:(e,s,l)=>{"use strict";l.d(s,{A:()=>t});let t=(0,l(9946).A)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},6605:(e,s,l)=>{Promise.resolve().then(l.bind(l,1878))}},e=>{var s=s=>e(e.s=s);e.O(0,[159,671,392,764,704,766,33,250,483,441,684,358],()=>s(6605)),_N_E=e.O()}]);